{% extends "global_base.html" %}


{% comment %}
Copyright (c) 2024 Qu Zhi
All Rights Reserved.

This software is proprietary and confidential.
Unauthorized copying, distribution, or modification of this software is strictly prohibited.
{% endcomment %}


{% load i18n %}

{% load socialaccount %}


{% block title %}{% trans "Login" %}{% endblock %}

{% block content %}

  <div class="login">

    <h2>{% trans "Login" %}</h2>

    <div class="error-container">
      {% if form.non_field_errors and request.method == "POST" %}
        <ul class='error_message'>
            {% for error in form.non_field_errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
      {% endif %}
    </div>

    <a href="{% provider_login_url 'google' process='login' next=next %}" class="btn-google">
      <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google logo">
      <span style="font-size: 24px; margin-bottom: 8px;">{% trans "Continue with Google" %}</span>
    </a>

    <!-- OR separator -->
    <div class="or-divider">
      <span>{% trans "or" %}</span>
    </div>

    <form method="post" action="{% url 'login' %}" novalidate id="login-form" class="login-form">
      {% csrf_token %}

        <div class="form-group">
          <label for="{{ form.username_or_email.id_for_label }}">{% trans "Username or Email:" %}</label>
          {{ form.username_or_email }}
        </div>

        <div class="form-group">
          <label for="{{ form.password.id_for_label }}">{% trans "Password:" %}</label>
          {{ form.password }}
        </div>

        <!-- Added: preserve ?next -->
        {% if next %}
          <input type="hidden" name="next" value="{{ next }}">
        {% endif %}

      <button type="submit">{% trans "Login" %}</button>
    </form>


    <p>{% trans "Don't have an account?" %} <a href="{% url 'signup' %}">{% trans "Sign up here" %}</a>. </p>

    <p>{% trans "Forgot your password?" %} <a href="{% url 'password_reset' %}">{% trans "Reset it here" %}</a>.</p>
 
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
        let loginForm = document.getElementById("login-form");
        let errorMessages = document.querySelector('.error_message');
    
        if (errorMessages) {
            loginForm.addEventListener("input", function () {
                errorMessages.style.display = "none";  // Hide errors as soon as the user types
            });
        }
    });
    </script>

{% endblock %}
